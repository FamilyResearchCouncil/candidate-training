version: '3.8'
services:
    app:
        env_file: ".env.${BRANCH_NAME_SLUG}"
        user: '0'
#        user: '1100' # use this if attaching to an nfs share
        deploy:
            replicas: 1
            labels:
                - "traefik.enable=true"
                - "traefik.http.routers.candidate-training-staging.rule=Host(`staging.candidate-training.frc.org`)"
#                - "traefik.http.services.candidate-training-staging.loadbalancer.server.port=3000"
                - "traefik.docker.network=${TRAEFIK_NETWORK}"
            placement:
                constraints:
                    - node.role == worker
        networks:
            - $TRAEFIK_NETWORK
            - default

    mysql:
        env_file: ".env.${BRANCH_NAME_SLUG}"

networks:
    traefik:
        name: $TRAEFIK_NETWORK
        external: true